/**
 * jquery.bookblock.js v1.0.2
 * http://www.codrops.com
 *
 * Licensed under the MIT license.
 * http://www.opensource.org/licenses/mit-license.php
 *
 * Copyright 2012, Codrops
 * http://www.codrops.com
 */
(function(c,d,m){var l=c.event,e,h;e=l.special.debouncedresize={setup:function(){c(this).on("resize",e.handler)},teardown:function(){c(this).off("resize",e.handler)},handler:function(a,b){var c=this,f=arguments,g=function(){a.type="debouncedresize";l.dispatch.apply(c,f)};h&&clearTimeout(h);b?g():h=setTimeout(g,e.threshold)},threshold:150};var n=c(d),j=d.Modernizr;c.BookBlock=function(a,b){this.$el=c(b);this._init(a)};c.BookBlock.defaults={speed:1E3,easing:"ease-in-out",shadows:!0,shadowSides:0.2,
    shadowFlip:0.1,perspective:1300,circular:!1,nextEl:"",prevEl:"",autoplay:!1,interval:3E3,keyboard:!0,onEndFlip:function(){return!1},onBeforeFlip:function(){return!1}};c.BookBlock.prototype={_init:function(a){this.options=c.extend(!0,{},c.BookBlock.defaults,a);this.$el.css("perspective",this.options.perspective);this.$items=this.$el.children(".bb-item");this.itemsCount=this.$items.length;this.current=0;this.previous=-1;this.$current=this.$items.eq(this.current).show();this.elWidth=this.$el.width();
    this.transEndEventName={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"}[j.prefixed("transition")]+".bookblock";this.support=j.csstransitions&&j.csstransforms3d;this._initEvents();this.options.autoplay&&(this.options.circular=!0,this._startSlideshow())},_initEvents:function(){var a=this;if(""!==this.options.nextEl)c(this.options.nextEl).on("click.bookblock",function(){a._action("next");return!1});
    if(""!==this.options.prevEl)c(this.options.prevEl).on("click.bookblock",function(){a._action("prev");return!1});!0==this.options.keyboard&&c(document).keydown(function(b){switch(b.keyCode||b.which){case 37:a._action("prev");break;case 39:a._action("next")}});n.on("debouncedresize",function(){a.elWidth=a.$el.width()})},_action:function(a,b){this._stopSlideshow();this._navigate(a,b)},_navigate:function(a,b){if(this.isAnimating)return!1;this.options.onBeforeFlip(this.current);this.isAnimating=!0;this.$current=
    this.$items.eq(this.current);b!==m?this.current=b:"next"===a?!this.options.circular&&this.current===this.itemsCount-1?this.end=!0:(this.previous=this.current,this.current=this.current<this.itemsCount-1?this.current+1:0):"prev"===a&&(!this.options.circular&&0===this.current?this.end=!0:(this.previous=this.current,this.current=0<this.current?this.current-1:this.itemsCount-1));this.$nextItem=!this.options.circular&&this.end?this.$current:this.$items.eq(this.current);this.support?this._layout(a):this._layoutNoSupport(a)},
    _layoutNoSupport:function(a){this.$items.hide();this.$nextItem.show();this.isAnimating=this.end=!1;this.options.onEndFlip(this.previous,this.current,"next"===a&&this.current===this.itemsCount-1||"prev"===a&&0===this.current)},_layout:function(a){var b=this,c=this._addSide("left",a),f=this._addSide("middle",a),g=this._addSide("right",a),d=c.find("div.bb-overlay"),e=f.find("div.bb-flipoverlay:first"),h=f.find("div.bb-flipoverlay:last"),j=g.find("div.bb-overlay"),k=this.end?400:this.options.speed;this.$items.hide();
        this.$el.prepend(c,f,g);f.css({transition:"all "+k+"ms "+this.options.easing}).on(this.transEndEventName,function(c){"bb-page"===c.target.className&&(b.$el.children("div.bb-page").remove(),b.$nextItem.show(),b.end=!1,b.isAnimating=!1,b.options.onEndFlip(b.previous,b.current,"next"===a&&b.current===b.itemsCount-1||"prev"===a&&0===b.current))});"prev"===a&&f.css({transform:"rotateY(-180deg)"});this.options.shadows&&!this.end&&(c="next"===a?{transition:"opacity "+this.options.speed/2+"ms linear "+this.options.speed/
            2+"ms"}:{transition:"opacity "+this.options.speed/2+"ms linear",opacity:this.options.shadowSides},g="next"===a?{transition:"opacity "+this.options.speed/2+"ms linear "+this.options.speed/2+"ms",opacity:this.options.shadowFlip}:{transition:"opacity "+this.options.speed/2+"ms linear"},k="next"===a?{transition:"opacity "+this.options.speed/2+"ms linear",opacity:this.options.shadowSides}:{transition:"opacity "+this.options.speed/2+"ms linear "+this.options.speed/2+"ms"},e.css("next"===a?{transition:"opacity "+
            this.options.speed/2+"ms linear"}:{transition:"opacity "+this.options.speed/2+"ms linear "+this.options.speed/2+"ms",opacity:this.options.shadowFlip}),h.css(g),d.css(c),j.css(k));setTimeout(function(){var c="next"===a?"rotateY(-180deg)":"rotateY(0deg)";b.end&&(c="next"===a?"rotateY(-15deg)":"rotateY(-165deg)");f.css({transform:c});b.options.shadows&&!b.end&&(e.css({opacity:"next"===a?b.options.shadowFlip:0}),h.css({opacity:"next"===a?0:b.options.shadowFlip}),d.css({opacity:"next"===a?b.options.shadowSides:
            0}),j.css({opacity:"next"===a?0:b.options.shadowSides}))},30)},_addSide:function(a,b){var d;switch(a){case "left":d=c('<div class="bb-page"><div class="bb-back"><div class="bb-outer"><div class="bb-content" style="width:'+this.elWidth+'px"><div class="bb-inner">'+("next"===b?this.$current.html():this.$nextItem.html())+'</div></div><div class="bb-overlay"></div></div></div></div>').css("z-index",102);break;case "middle":d=c('<div class="bb-page"><div class="bb-front"><div class="bb-outer"><div class="bb-content" style="left:'+
        -this.elWidth/2+"px;width:"+this.elWidth+'px"><div class="bb-inner">'+("next"===b?this.$current.html():this.$nextItem.html())+'</div></div><div class="bb-flipoverlay"></div></div></div><div class="bb-back"><div class="bb-outer"><div class="bb-content" style="width:'+this.elWidth+'px"><div class="bb-inner">'+("next"===b?this.$nextItem.html():this.$current.html())+'</div></div><div class="bb-flipoverlay"></div></div></div></div>').css("z-index",103);break;case "right":d=c('<div class="bb-page"><div class="bb-front"><div class="bb-outer"><div class="bb-content" style="left:'+
        -this.elWidth/2+"px;width:"+this.elWidth+'px"><div class="bb-inner">'+("next"===b?this.$nextItem.html():this.$current.html())+'</div></div><div class="bb-overlay"></div></div></div></div>').css("z-index",101)}return d},_startSlideshow:function(){var a=this;this.slideshow=setTimeout(function(){a._navigate("next");a.options.autoplay&&a._startSlideshow()},this.options.interval)},_stopSlideshow:function(){this.options.autoplay&&(clearTimeout(this.slideshow),this.options.autoplay=!1)},next:function(){this._action("next")},
    prev:function(){this._action("prev")},jump:function(a){a-=1;if(a===this.current||a>=this.itemsCount||0>a)return!1;this._action(a>this.current?"next":"prev",a)},isActive:function(){return this.isAnimating},update:function(){var a=this.$items.eq(this.current);this.$items=this.$el.children(".bb-item");this.itemsCount=this.$items.length;this.current=a.index()}};c.fn.bookblock=function(a){var b=c.data(this,"bookblock");if("string"===typeof a){var e=Array.prototype.slice.call(arguments,1);this.each(function(){b?
    !c.isFunction(b[a])||"_"===a.charAt(0)?d.console&&d.console.error("no such method '"+a+"' for bookblock instance"):b[a].apply(b,e):d.console&&d.console.error("cannot call methods on bookblock prior to initialization; attempted to call method '"+a+"'")})}else this.each(function(){b?b._init():b=c.data(this,"bookblock",new c.BookBlock(a,this))});return b}})(jQuery,window);